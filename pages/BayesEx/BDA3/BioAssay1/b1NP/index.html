<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="/assets/favicon.png"> <title>bio1np.md</title> <header> <div class=blog-name ><a href="/">Jason Pekos</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/menu1/">Misc stuff</a> <li><a href="/menu2/">Contact</a> <li><a href="/menu3/">Teaching</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content > <h1 id=the_dataset ><a href="#the_dataset" class=header-anchor >The Dataset:</a></h1> <p>We have the following data from Racine et al &#40;1986&#41; via BDA3:</p> <table><tr><th align=right >Dose &#40;log g/ml&#41;<th align=right >Number of Rats<th align=right >Number of Deaths<tr><td align=right >-0.86<td align=right >5<td align=right >0<tr><td align=right >-0.30<td align=right >5<td align=right >1<tr><td align=right >-0.05<td align=right >5<td align=right >3<tr><td align=right >0.73<td align=right >5<td align=right >5</table> <h1 id=imports ><a href="#imports" class=header-anchor >Imports</a></h1> <p>NumPyro</p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> jax
<span class=hljs-keyword >from</span> jax <span class=hljs-keyword >import</span> numpy <span class=hljs-keyword >as</span> jnp

<span class=hljs-keyword >import</span> numpyro
<span class=hljs-keyword >from</span> numpyro <span class=hljs-keyword >import</span> distributions <span class=hljs-keyword >as</span> dist, infer</code></pre> <p>Plotting and data manipulation</p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> pandas <span class=hljs-keyword >as</span> pd
<span class=hljs-keyword >import</span> matplotlib.pyplot <span class=hljs-keyword >as</span> plt
<span class=hljs-keyword >import</span> arviz <span class=hljs-keyword >as</span> az
<span class=hljs-keyword >import</span> seaborn <span class=hljs-keyword >as</span> sns</code></pre> <h1 id=load_the_data ><a href="#load_the_data" class=header-anchor >Load the data</a></h1> <pre><code class="python hljs">dose = [-<span class=hljs-number >0.86</span>, -<span class=hljs-number >0.30</span>, -<span class=hljs-number >0.05</span>, <span class=hljs-number >0.73</span>]
numDeaths = [<span class=hljs-number >0</span>,<span class=hljs-number >1</span>,<span class=hljs-number >3</span>,<span class=hljs-number >5</span>]
numAnimals = [<span class=hljs-number >5</span>,<span class=hljs-number >5</span>,<span class=hljs-number >5</span>,<span class=hljs-number >5</span>]

data = pd.DataFrame(
	{
	<span class=hljs-string >&quot;dose&quot;</span>: dose,
	<span class=hljs-string >&quot;deaths&quot;</span>: numDeaths,
	<span class=hljs-string >&quot;animals&quot;</span>: numAnimals
	}
)</code></pre> <h1 id=set_up_the_model ><a href="#set_up_the_model" class=header-anchor >Set Up The Model</a></h1> <p>We have counts of deaths, so we&#39;ll use a binomial likelihood:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mi mathvariant=normal ><mi mathvariant=normal >B</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >a</mi><mi mathvariant=normal >l</mi><mo stretchy=false >(</mo><msub><mi mathvariant=normal >n</mi><mi mathvariant=normal >i</mi></msub><mo separator=true >,</mo><msub><mi>θ</mi><mi mathvariant=normal >i</mi></msub><mo stretchy=false >)</mo></mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">y_i \sim \operatorname{Binomial(n_i, \theta_i)}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop ><span class="mord mathrm">Binomial(</span><span class=mord ><span class="mord mathrm">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathrm">,</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3175em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathrm">)</span></span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the number of animals in the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>th group, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the probability of death in the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>th group. The probability of death should be a function of the dose, so we could model this as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\theta_i = \alpha + \beta x_i </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> <p>But we need the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to be between 0 and 1, so we&#39;ll use a logit function to map the linear predictor to the probability scale:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=normal >logit</mi><mo>⁡</mo><mo stretchy=false >(</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy=false >)</mo><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\operatorname{logit}(\theta_i) = \alpha + \beta x_i </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop ><span class="mord mathrm">logit</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> <p>A corresponding NumPyro model here is:</p> <pre><code class="python hljs">logistic = <span class=hljs-keyword >lambda</span> x: <span class=hljs-number >1</span> / (<span class=hljs-number >1</span> + jnp.exp(-x))

<span class=hljs-keyword >def</span> <span class="hljs-title function_">logisticmodel</span>(<span class=hljs-params >dose, animals, deaths</span>):
	alpha = numpyro.sample(<span class=hljs-string >&quot;alpha&quot;</span>, dist.Uniform(-<span class=hljs-number >100</span>, <span class=hljs-number >100</span>))
	beta = numpyro.sample(<span class=hljs-string >&quot;beta&quot;</span>, dist.Uniform(-<span class=hljs-number >100</span>, <span class=hljs-number >100</span>))
	
	<span class=hljs-keyword >with</span> numpyro.plate(<span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-built_in >len</span>(dose)):
		numpyro.sample(<span class=hljs-string >&quot;obs&quot;</span>,
						dist.Binomial(animals,
						              logistic(alpha + beta*dose)),
						obs = deaths)</code></pre> <h1 id=sampling ><a href="#sampling" class=header-anchor >Sampling</a></h1> <p>First, set up the sampler &#40;we&#39;re using NUTS here, while BDA3 uses a grid approx over the likelihood&#41;:</p> <pre><code class="python hljs">sampler = infer.MCMC(
    sampler = infer.NUTS(logisticmodel),
    num_chains = <span class=hljs-number >1</span>,
    num_samples = <span class=hljs-number >2000</span>,
    num_warmup= <span class=hljs-number >1000</span>
)</code></pre> <p>Next, sample from the model:</p> <pre><code class="python hljs">sampler.run(
    jax.random.PRNGKey(<span class=hljs-number >1</span>),
    dose = jnp.array(data.dose),
    animals = jnp.array(data.animals),
    deaths = jnp.array(data.deaths)
)

samples = sampler.get_samples()</code></pre> <h1 id=results ><a href="#results" class=header-anchor >Results</a></h1> <h3 id=posterior_analysis ><a href="#posterior_analysis" class=header-anchor >Posterior Analysis</a></h3> <p>We can reproduce Figure 3.3 from BDA:</p> <img src="/assets/bio1/bio1p1.png" alt=""> <h3 id=ld50_distribution ><a href="#ld50_distribution" class=header-anchor >LD50 Distribution</a></h3> <p>What we want here is the dose &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41; such that:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>E</mi><mrow><mo fence=true >[</mo><mfrac><mrow><mi>d</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>h</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><mrow><mi>a</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>l</mi><msub><mi>s</mi><mi>i</mi></msub></mrow></mfrac><mo fence=true >]</mo></mrow><mo>=</mo><mi mathvariant=normal >logistic</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>α</mi><mo>+</mo><mi>β</mi><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=false >)</mo><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">E\left[\frac{deaths_{i}}{animals_i}\right] = \operatorname{logistic}(\alpha + \beta x_i) = 0.5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">anima</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop ><span class="mord mathrm">logistic</span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.5</span></span></span></span></span> <p>LD50 only makes sense if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta &lt; 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span>, so we&#39;ll restrict our attention to those samples:</p> <pre><code class="python hljs"><span class=hljs-comment ># Posterior conditional on positive beta:</span>
idx = samples[<span class=hljs-string >&quot;beta&quot;</span>] &gt; <span class=hljs-number >0</span>
cond_samples = {k: v[idx] <span class=hljs-keyword >for</span> k, v <span class=hljs-keyword >in</span> samples.items()}

<span class=hljs-comment ># Posterior LD50 distribution:</span>
ld50_dist = cond_samples[<span class=hljs-string >&quot;alpha&quot;</span>] / -cond_samples[<span class=hljs-string >&quot;beta&quot;</span>]</code></pre> <p>Reproducing Figure 3.4 from BDA:</p> <pre><code class="python hljs">plt.hist(ld50_dist,
         bins = <span class=hljs-number >20</span>,
         color = <span class=hljs-string >&quot;C0&quot;</span>, 
        edgecolor = <span class=hljs-string >&quot;black&quot;</span>)
plt.xlabel(<span class=hljs-string >&quot;LD50&quot;</span>)</code></pre> <img src="/assets/bio1/ld50_dist.png" alt=""> <h1 id=an_informative_prior ><a href="#an_informative_prior" class=header-anchor >An Informative Prior:</a></h1> <p>BDA3 suggests a multivariate normal prior on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span> in one of the exercises. </p> <blockquote> <p><strong>BDA3 Pg. 82:</strong> Computation: in the bioassay example, replace the uniform prior density by a joint normal prior distribution on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>α</mi><mo separator=true >,</mo><mi>β</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(\alpha, \beta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mclose >)</span></span></span></span>, with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>∼</mo><mi mathvariant=script >N</mi><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><msup><mn>2</mn><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\alpha \sim \mathcal{N}(0, 2^2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>∼</mo><mi mathvariant=script >N</mi><mo stretchy=false >(</mo><mn>10</mn><mo separator=true >,</mo><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\beta \sim \mathcal{N}(10, 10^2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class=mopen >(</span><span class=mord >10</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord >1</span><span class=mord ><span class=mord >0</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >corr</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>α</mi><mo separator=true >,</mo><mi>β</mi><mo stretchy=false >)</mo><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\operatorname{corr}(\alpha, \beta)=0.5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop ><span class="mord mathrm">corr</span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.5</span></span></span></span></p> </blockquote> <p>We can do the same in NumPyro:</p> <pre><code class="python hljs"><span class=hljs-keyword >def</span> <span class="hljs-title function_">logisticmodel</span>(<span class=hljs-params >dose, animals, deaths</span>):
    mu = jnp.array([<span class=hljs-number >0</span>, <span class=hljs-number >10</span>])
    cov_matrix = jnp.array([[<span class=hljs-number >2</span>**<span class=hljs-number >2</span>, <span class=hljs-number >0.5</span> * <span class=hljs-number >2</span> * <span class=hljs-number >10</span>],
                            [<span class=hljs-number >0.5</span> * <span class=hljs-number >2</span> * <span class=hljs-number >10</span>, <span class=hljs-number >10</span>**<span class=hljs-number >2</span>]])

    alpha, beta = numpyro.sample(<span class=hljs-string >&quot;alpha_beta&quot;</span>,
                                 dist.MultivariateNormal(loc=mu, 
                                    covariance_matrix=cov_matrix))

    <span class=hljs-keyword >with</span> numpyro.plate(<span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-built_in >len</span>(dose)):
        numpyro.sample(<span class=hljs-string >&quot;obs&quot;</span>,
                       dist.Binomial(animals,
                                     logistic(alpha + beta*dose)),
                       obs = deaths)</code></pre> <p>Where inference proceeds exactly as before.</p> <h2 id=parsing_results ><a href="#parsing_results" class=header-anchor >Parsing results:</a></h2> <p>NumPyro returns a dictionary of samples, where the keys are the strings in our <code>numpyro.sample</code> statements. We can put this back into the format of the original model:</p> <pre><code class="python hljs">alpha_samples = [<span class=hljs-built_in >float</span>(val) <span class=hljs-keyword >for</span> val,_ <span class=hljs-keyword >in</span> samples[<span class=hljs-string >&quot;alpha_beta&quot;</span>]]
beta_samples =  [<span class=hljs-built_in >float</span>(val) <span class=hljs-keyword >for</span> _,val <span class=hljs-keyword >in</span> samples[<span class=hljs-string >&quot;alpha_beta&quot;</span>]]

samples = {<span class=hljs-string >&quot;alpha&quot;</span>: alpha_samples,
           <span class=hljs-string >&quot;beta&quot;</span>: beta_samples}</code></pre> <h2 id=plotting_the_new_posterior ><a href="#plotting_the_new_posterior" class=header-anchor >Plotting the new posterior:</a></h2> <p><img src="/assets/bio1/bio1p3.png" alt=""> <img src="/assets/bio1/ld50_dist3.png" alt=""></p> <div class=page-foot > JasonPekos. Last modified: May 29, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> <script> var coll = document.getElementsByClassName("collapsible"); var i; for (i = 0; i < coll.length; i++) { coll[i].addEventListener("click", function() { this.classList.toggle("active"); var content = this.nextElementSibling; if (content.style.display === "block") { content.style.display = "none"; } else { content.style.display = "block"; } }); } </script> </div>